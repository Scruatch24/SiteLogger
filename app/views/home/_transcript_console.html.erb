<div id="textSection" class="space-y-2 transition-all duration-500">
  <div class="relative flex items-center justify-between">
    <label data-nosnippet class="text-xs font-black text-black uppercase tracking-widest ml-2.5 md:ml-0"><%= t('live_transcript') %></label>
    
    <!-- Language Selector -->
    <div class="relative mr-1.5 md:mr-0">
      <%
        # Determine starting language (localStorage should still be the ultimate source of truth in JS, 
        # but the server can guess the "last set" value from the profile/session to prevent flicker)
        current_trans_lang = @profile.try(:transcription_language).presence || session[:transcription_language] || I18n.locale.to_s
        is_ka = (current_trans_lang == "ka" || current_trans_lang == "ge")
      %>
      <button id="languageSelectorBtn" type="button" 
              class="flex items-center gap-1.5 px-2.5 py-1 bg-white border-2 border-black rounded-lg text-[10px] font-black uppercase tracking-widest shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-x-[1px] active:translate-y-[1px] transition-all hover:bg-orange-50">
        <span id="currentLangFlag" class="fi fi-<%= is_ka ? 'ge' : 'us' %> scale-90 rounded-sm"></span>
        <span id="currentLangText"><%= is_ka ? t('georgian') : t('english') %></span>
        <svg class="h-2.5 w-2.5 transition-transform duration-200" id="langChevron" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path d="M19 9l-7 7-7-7" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </button>
      
      <div id="languageMenu" class="hidden absolute right-0 z-[100] mt-2 w-auto min-w-[140px] bg-white border-2 border-black rounded-xl overflow-hidden animate-in fade-in zoom-in-95 duration-200">
        <button type="button" onclick="setTranscriptLanguage('en')" 
                class="w-full flex items-center gap-2.5 px-4 py-3 text-xs font-black hover:bg-orange-50 transition-colors border-b-2 border-black group whitespace-nowrap">
            <span class="fi fi-us rounded-sm scale-110 shrink-0"></span> 
            <span><%= t('english') %></span>
            <svg id="check-en" class="h-3.5 w-3.5 text-orange-600 shrink-0 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="4"><path d="M5 13l4 4L19 7" /></svg>
        </button>
        <button type="button" onclick="setTranscriptLanguage('ge')" 
                class="w-full flex items-center gap-2.5 px-4 py-3 text-xs font-black hover:bg-orange-50 transition-colors group whitespace-nowrap">
            <span class="fi fi-ge rounded-sm scale-110 shrink-0"></span> 
            <span><%= t('georgian') %></span>
            <svg id="check-ge" class="h-3.5 w-3.5 text-orange-600 shrink-0 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="4"><path d="M5 13l4 4L19 7" /></svg>
        </button>
      </div>
    </div>
  </div>
  <div id="transcriptContainer" class="transcript-container" data-audio-target="transcriptContainer">
     <textarea id="mainTranscript" 
               rows="6"
               class="w-full bg-white border-2 border-black rounded-xl p-5 text-black text-sm font-medium leading-relaxed resize-none outline-none placeholder:text-gray-400 custom-scrollbar overflow-hidden"
               style="max-height: 800px; field-sizing: content;"
               oninput="autoResize(this); updateDynamicCountersCheck(this)"
               placeholder="<%= t('transcript_placeholder') %>"></textarea>
    <div id="charCounter" class="flex justify-end mt-1 px-1">
      <span data-nosnippet class="text-[9px] font-black text-gray-400 uppercase tracking-widest">
        <span id="currentCharCount">0</span> / <span id="mainTranscriptMax"><%= @profile.char_limit %></span>
      </span>
    </div>
  </div>
  
  <!-- Transcript Actions -->
  <div class="flex items-center justify-between gap-3 ml-2 md:ml-0 mr-1.5 md:mr-0">
    <button id="enhanceTranscriptBtn" type="button" data-nosnippet data-label-default="<%= t('enhance_text') %>" data-label-loading="<%= t('enhancing_text') %>" class="flex items-center gap-2 px-3.5 py-2 bg-white border-2 border-black text-black rounded-xl transition-all shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] hover:bg-orange-50 active:shadow-none active:translate-x-[2px] active:translate-y-[2px]" title="<%= t('enhance_text_title') %>">
      <%= image_tag "icons/wand.svg", alt: "", class: "h-3.5 w-3.5" %>
      <span class="text-[10px] font-black uppercase tracking-widest"><%= t('enhance_text') %></span>
    </button>

    <button id="reParseBtn" data-nosnippet class="flex items-center gap-2 px-4 py-2 bg-orange-500 border-2 border-black text-white rounded-xl transition-all apply-btn-hover shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-x-[2px] active:translate-y-[2px]" title="Analyze Text">
      <span class="text-[10px] font-black uppercase tracking-widest"><%= t('apply') %></span>
      <svg class="h-3.5 w-3.5 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M14 5l7 7m0 0l-7 7m7-7H3" />
      </svg>
    </button>
  </div>

  <%= render 'ai_assistant_section' %>
</div>
