<div class="flex justify-between items-center pb-4 border-b-2 border-dashed border-gray-200">
  <h2 class="text-sm font-black uppercase tracking-widest text-black"><%= t('job_details') %></h2>
  <div class="flex items-center gap-2">
    <span id="dateDisplay" data-nosnippet class="text-xs font-bold text-orange-600"><%= l(Time.now, format: :long) %></span>
    <div class="relative" data-popup-container>
      <button type="button" onclick="toggleMainCalendar(this)" class="w-7 h-7 border-2 border-black rounded-lg bg-white btn-icon-hover transition-all flex items-center justify-center group active:scale-95 shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-x-[1px] active:translate-y-[1px]">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 text-black" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
      </button>
      <!-- Main Date Calendar Popup -->
      <div id="mainCalendarPopup" class="hidden absolute top-full right-0 mt-2 bg-white border-2 border-black rounded-xl z-[100] p-4 min-w-[280px]">
        <div class="flex justify-between items-center mb-3">
          <button type="button" onclick="changeMainCalendarMonth(-1)" class="w-8 h-8 border-2 border-black rounded-lg md:hover:bg-orange-50 flex items-center justify-center font-black text-lg transition-all active:scale-95 active:translate-x-[1px] active:translate-y-[1px] shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:shadow-none bg-white leading-none pb-0.5 active:bg-orange-600 active:text-white">‹</button>
          <span id="mainCalendarMonthYear" class="text-sm font-black uppercase tracking-widest text-black"></span>
          <button type="button" onclick="changeMainCalendarMonth(1)" class="w-8 h-8 border-2 border-black rounded-lg md:hover:bg-orange-50 flex items-center justify-center font-black text-lg transition-all active:scale-95 active:translate-x-[1px] active:translate-y-[1px] shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:shadow-none bg-white leading-none pb-0.5 active:bg-orange-600 active:text-white">›</button>
        </div>
        <div data-nosnippet class="grid grid-cols-7 gap-1 mb-2">
          <% t('date.abbr_day_names').each do |day| %>
            <span class="text-[9px] font-bold text-gray-400 text-center"><%= day.upcase %></span>
          <% end %>
        </div>
        <div id="mainCalendarDays" class="grid grid-cols-7 gap-1"></div>
      </div>
    </div>
  </div>
</div>

<% is_guest = @profile.guest? && !user_signed_in? %>
<!-- Hidden field to maintain backward compatibility with gatherLogData -->
<input type="hidden" id="editClient" value="">

<% unless is_guest %>
<div class="space-y-3">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
    <!-- FROM Field -->
    <div class="space-y-1">
      <label class="block text-[9px] font-bold text-gray-500 uppercase ml-1"><%= t('from_label') %></label>
      <button type="button" id="fromFieldBtn" onclick="openFromModal()"
              class="w-full border-2 border-black rounded-xl bg-white shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] h-[52px] flex items-center justify-between px-3 text-left transition-all hover:shadow-[4px_4px_0px_0px_rgba(234,88,12,1)] hover:border-orange-500 group">
        <span id="fromFieldDisplay" class="text-sm font-black text-black truncate"><%= @profile.business_name.presence || t('from_placeholder') %></span>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400 group-hover:text-orange-500 flex-shrink-0 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
        </svg>
      </button>
    </div>

    <!-- BILLED TO Field -->
    <div class="space-y-1">
      <label class="block text-[9px] font-bold text-gray-500 uppercase ml-1"><%= t('billed_to_label') %></label>
      <button type="button" id="billedToFieldBtn" onclick="openBilledToModal()"
              class="w-full border-2 border-black rounded-xl bg-white shadow-[3px_3px_0px_0px_rgba(0,0,0,1)] h-[52px] flex items-center justify-between px-3 text-left transition-all hover:shadow-[4px_4px_0px_0px_rgba(234,88,12,1)] hover:border-orange-500 group">
        <span id="billedToFieldDisplay" class="text-sm font-black text-gray-300 truncate"><%= t('billed_to_placeholder') %></span>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400 group-hover:text-orange-500 flex-shrink-0 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
        </svg>
      </button>
    </div>
  </div>
</div>
<% end %>
